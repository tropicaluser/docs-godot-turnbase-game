# Taking Damage & Hit Effects

## EnemyButton 

### Add Process Code

```py {9-11} filename="EnemyButton.gd"
class_name EnemyButton extends TextureButton

onready var _animation_player: AnimationPlayer = $AnimationPlayer

# default animation
func _ready() -> void:
	_animation_player.play("RESET")

# called every frame, (_ means not used)
func _process(_delta: float) -> void:
	self_modulate.a = randf()

func _on_EnemyButton_focus_entered():
	_animation_player.play("highlight")

func _on_EnemyButton_focus_exited():
	_animation_player.play("RESET")
```

### Add Timer

Click EnemyButton. Click "+" add Timer. Rename to Hit.
Click Hit. In Inspector set Wait Time: 0.5, One Shot to ON.

![Alt text](../../images/07-battle-scene-01.png)

### Wait until Hit finish then turn of Hit Effect.

```py {3-6, 13-15, 23-29} filename="EnemyButton.gd"
class_name EnemyButton extends TextureButton

var hp_max: int = 1
var hp: int = hp_max

onready var _hit: Timer = $Hit
onready var _animation_player: AnimationPlayer = $AnimationPlayer

# default animation
func _ready() -> void:
	_animation_player.play("RESET")

# Hit effect - called every frame, (_ means not used)
func _process(_delta: float) -> void:
	self_modulate.a = randf()

func _on_EnemyButton_focus_entered():
	_animation_player.play("highlight")

func _on_EnemyButton_focus_exited():
	_animation_player.play("RESET")

func heal_hurt(value: int) -> void:
	hp = clamp(hp + value, 0, hp_max)
	if value < 0:
		set_process(true)
		_hit.start()
		yield(_hit, "timeout")
		set_process(false)
		self_modulate.a = 1.0
```

### Run game (has a bug)

Run game. The Monkey should be fade in and out quickly. Close Game.

![Alt text](../../images/07-battle-scene-02.png)

### Fix the bug

Open "EnemyButton.gd"

```py {3} filename="EnemyButton.gd"
func _ready() -> void:
	_animation_player.play("RESET")
	set_process(false)
```

### Validate fix

Run Game again. The Monkey should not fade in and out.

## Battle Hit Script
```py {1,3} filename="Battle.gd"
func _on_EnemiesMenu_button_pressed(enemy_button: EnemyButton) -> void:
	print("Battle - EnemiesMenu")
	enemy_button.heal_hurt(-1)
```

### Run Game

Run Game. Click FIGHT. And Click a second time. 
One Monkey should be fade in and out quickly.

![Alt text](../../images/07-battle-scene-03.png)

## Use Shader on Hit Effect

